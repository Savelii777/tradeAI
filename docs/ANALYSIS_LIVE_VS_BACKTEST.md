# –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã: –ë—ç–∫—Ç–µ—Å—Ç vs Live Trading

## –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

**–°–∏–º–ø—Ç–æ–º**: –ù–∞ –±—ç–∫—Ç–µ—Å—Ç–µ –º–æ–¥–µ–ª—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—Ç–ª–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (Win Rate 80%+, Walk-Forward 70%+), –Ω–æ –≤ live trading —Å–∏–≥–Ω–∞–ª—ã LONG –∏ SHORT –∏–º–µ—é—Ç confidence —Ç–æ–ª—å–∫–æ ~40% (–≤–º–µ—Å—Ç–æ —Ç—Ä–µ–±—É–µ–º—ã—Ö 50%+), –∏–∑-–∑–∞ —á–µ–≥–æ —Å–∏–≥–Ω–∞–ª—ã –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç.

**–ü—Ä–∏—á–∏–Ω–∞**: –ö–æ–º–±–∏–Ω–∞—Ü–∏—è –ø—Ä–æ–±–ª–µ–º:
1. **Feature Distribution Shift** ‚Äî –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è –º–µ–∂–¥—É –æ–±—É—á–µ–Ω–∏–µ–º –∏ live
2. **Lookahead Bias** ‚Äî –º–æ–¥–µ–ª—å "–≤–∏–¥–∏—Ç –±—É–¥—É—â–µ–µ" –ø—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏, –Ω–æ –Ω–µ –≤ live
3. **–ü–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ** ‚Äî Win Rate 80%+ –Ω–∞ –±—ç–∫—Ç–µ—Å—Ç–µ = —Å–ª–∏—à–∫–æ–º —Ö–æ—Ä–æ—à–æ, —á—Ç–æ–±—ã –±—ã—Ç—å –ø—Ä–∞–≤–¥–æ–π

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û: Win Rate 80% = –ü–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ

Win Rate 80%+ –Ω–∞ –±—ç–∫—Ç–µ—Å—Ç–µ ‚Äî —ç—Ç–æ **–∫—Ä–∞—Å–Ω—ã–π —Ñ–ª–∞–≥**, –∞ –Ω–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ. 

–í —Ä–µ–∞–ª—å–Ω–æ–º ML-—Ç—Ä–µ–π–¥–∏–Ω–≥–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
- **Win Rate 55-60%** ‚Äî —Ö–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- **Win Rate 60-65%** ‚Äî –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- **Win Rate 70%+** ‚Äî —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ

–ü—Ä–∏—á–∏–Ω–∞: –≤ `create_targets_v1()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `shift(-LOOKAHEAD)` ‚Äî –º–æ–¥–µ–ª—å "—Å–º–æ—Ç—Ä–∏—Ç –≤ –±—É–¥—É—â–µ–µ" –ø—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏. –í live –±—É–¥—É—â–µ–≥–æ –Ω–µ—Ç.

---

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ —ç—Ç–æ–º PR

–í —Ñ–∞–π–ª–µ `src/utils/constants.py` –±—ã–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏:

```python
ABSOLUTE_PRICE_FEATURES = [
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ ...
    # ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û: MACD –ø—Ä–∏–∑–Ω–∞–∫–∏ (–∞–±—Å–æ–ª—é—Ç–Ω–∞—è —Ä–∞–∑–Ω–∏—Ü–∞ —Ü–µ–Ω)
    'm5_macd', 'm5_macd_signal', 'm5_macd_histogram', 'm5_macd_histogram_change',
]
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ**: MACD = EMA(12) - EMA(26) ‚Äî —ç—Ç–æ –∞–±—Å–æ–ª—é—Ç–Ω–∞—è —Ä–∞–∑–Ω–∏—Ü–∞ –≤ —Ü–µ–Ω–∞—Ö. –ü—Ä–∏ —Ä–∞–∑–Ω—ã—Ö —Ü–µ–Ω–∞—Ö –∞–∫—Ç–∏–≤–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, BTC $25,000 vs $95,000) –∑–Ω–∞—á–µ–Ω–∏—è MACD –±—É–¥—É—Ç –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ –æ—Ç–ª–∏—á–∞—Ç—å—Å—è, –≤—ã–∑—ã–≤–∞—è Feature Distribution Shift.

---

## –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑

### 1. –ß—Ç–æ —Ç–∞–∫–æ–µ Feature Distribution Shift?

–≠—Ç–æ —Å–∏—Ç—É–∞—Ü–∏—è, –∫–æ–≥–¥–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—Ö–æ–¥–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (features) –º–æ–¥–µ–ª–∏ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –º–µ–∂–¥—É:
- **–û–±—É—á–µ–Ω–∏–µ–º/–±—ç–∫—Ç–µ—Å—Ç–æ–º**: –º–æ–¥–µ–ª—å –æ–±—É—á–µ–Ω–∞ –Ω–∞ –¥–∞–Ω–Ω—ã—Ö –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
- **Live trading**: –º–æ–¥–µ–ª—å –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –∏–º–µ—Ç—å –¥—Ä—É–≥—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É

### 2. –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –≤ –∫–æ–¥–µ

#### 2.1. –ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–µ (cumsum) –ø—Ä–∏–∑–Ω–∞–∫–∏

–í —Ñ–∞–π–ª–µ `src/features/feature_engine.py` (—Å—Ç—Ä–æ–∫–∏ 100-102) –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–∏–∑–Ω–∞–∫–∏ —Å `cumsum()`:

```python
'consecutive_up': (direction == 1).groupby((direction != 1).cumsum()).cumsum(),
'consecutive_down': (direction == -1).groupby((direction != -1).cumsum()).cumsum()
```

**–ü—Ä–æ–±–ª–µ–º–∞**: 
- –í –±—ç–∫—Ç–µ—Å—Ç–µ: –¥–∞–Ω–Ω—ã–µ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å 2017 –≥–æ–¥–∞ ‚Üí cumsum –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è –∑–∞ 8 –ª–µ—Ç
- –í live: –¥–∞–Ω–Ω—ã–µ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 1000-2000 —Å–≤–µ—á–µ–π ‚Üí cumsum –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ö–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ —Ä–∞–∑–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤!

**–ü—Ä–∏–º–µ—Ä**:
- –ë—ç–∫—Ç–µ—Å—Ç: `consecutive_up = 1547` (–Ω–∞–∫–æ–ø–ª–µ–Ω–æ –∑–∞ –≥–æ–¥—ã)
- Live: `consecutive_up = 23` (–Ω–∞–∫–æ–ø–ª–µ–Ω–æ –∑–∞ –¥–Ω–∏)

#### 2.2. –ê–±—Å–æ–ª—é—Ç–Ω—ã–µ —Ü–µ–Ω–æ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏

–í `src/utils/constants.py` —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏:

```python
ABSOLUTE_PRICE_FEATURES = [
    'm5_ema_9', 'm5_ema_21', 'm5_ema_50', 'm5_ema_200',  # –ê–±—Å–æ–ª—é—Ç–Ω—ã–µ EMA
    'm5_bb_upper', 'm5_bb_middle', 'm5_bb_lower',        # –ê–±—Å–æ–ª—é—Ç–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ BB  
    'm5_volume_ma_5', 'm5_volume_ma_10', 'm5_volume_ma_20',
    'm5_atr_7', 'm5_atr_14', 'm5_atr_21', 'm5_atr_14_ma',
    'm5_volume_delta', 'm5_volume_trend',
    # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: MACD —Ç–æ–∂–µ –∞–±—Å–æ–ª—é—Ç–Ω–∞—è —Ä–∞–∑–Ω–∏—Ü–∞ —Ü–µ–Ω!
    'm5_macd', 'm5_macd_signal', 'm5_macd_histogram',
]
```

**–ü—Ä–æ–±–ª–µ–º–∞**:
- –í –æ–±—É—á–µ–Ω–∏–∏: BTC —Å—Ç–æ–∏–ª $25,000 ‚Üí `m5_ema_200 = 25000`
- –í live: BTC —Å—Ç–æ–∏—Ç $95,000 ‚Üí `m5_ema_200 = 95000`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ú–æ–¥–µ–ª—å –≤–∏–¥–∏—Ç —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ –¥—Ä—É–≥–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏ —Ç–µ—Ä—è–µ—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å!

**MACD** - –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–æ:
- MACD = EMA(12) - EMA(26) - —ç—Ç–æ **–∞–±—Å–æ–ª—é—Ç–Ω–∞—è —Ä–∞–∑–Ω–∏—Ü–∞** –≤ —Ü–µ–Ω–∞—Ö
- –ü—Ä–∏ BTC $25,000: MACD –º–æ–∂–µ—Ç –±—ã—Ç—å $500
- –ü—Ä–∏ BTC $95,000: MACD –º–æ–∂–µ—Ç –±—ã—Ç—å $2,000
- **–≠—Ç–æ—Ç –ø—Ä–∏–∑–Ω–∞–∫ –Ω–µ –±—ã–ª –∏—Å–∫–ª—é—á—ë–Ω —Ä–∞–Ω–µ–µ!** ‚Üê –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ —ç—Ç–æ–º PR

#### 2.3. Rolling Normalization —Å —Ä–∞–∑–Ω–æ–π –¥–ª–∏–Ω–æ–π –æ–∫–Ω–∞

–í `train_mtf.py` (—Å—Ç—Ä–æ–∫–∞ 181):

```python
features = self.feature_engine.generate_all_features(df, normalize=False)
```

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –£–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ - normalization –æ—Ç–∫–ª—é—á–µ–Ω–∞.

–ù–æ –≤ `feature_engine.py` –µ—Å—Ç—å –º–µ—Ç–æ–¥ `normalize_features()` —Å `window=500`:
- –ü—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏: –æ–∫–Ω–æ –∏–∑ 500 —Ç–æ—á–µ–∫ –Ω–∞ 60 –¥–Ω—è—Ö –¥–∞–Ω–Ω—ã—Ö
- –í live: –æ–∫–Ω–æ –∏–∑ 500 —Ç–æ—á–µ–∫ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 1000 —Å–≤–µ—á–∞—Ö
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –†–∞–∑–Ω—ã–µ z-score –∏–∑-–∑–∞ —Ä–∞–∑–Ω—ã—Ö –±–∞–∑–æ–≤—ã—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫

### 3. –ü–æ—á–µ–º—É Confidence –Ω–∏–∑–∫–∏–π?

–ú–æ–¥–µ–ª—å LightGBM –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è (`direction_model`) –≤—ã–¥–∞—ë—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ `predict_proba()`.

–ö–æ–≥–¥–∞ –º–æ–¥–µ–ª—å –≤–∏–¥–∏—Ç:
- –ü—Ä–∏–∑–Ω–∞–∫–∏, –∑–Ω–∞—á–µ–Ω–∏—è –∫–æ—Ç–æ—Ä—ã—Ö —Å–∏–ª—å–Ω–æ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è –æ—Ç –æ–±—É—á–∞—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–∏–∑–Ω–∞–∫–∏ —Å –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º

–û–Ω–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è "–Ω–µ—É–≤–µ—Ä–µ–Ω–Ω–æ–π" –∏ –≤—ã–¥–∞—ë—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –±–ª–∏–∑–∫–∏–µ –∫ 33% –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Å–∞ (LONG, SHORT, SIDEWAYS), –≤–º–µ—Å—Ç–æ —É–≤–µ—Ä–µ–Ω–Ω—ã—Ö 60%+ –¥–ª—è –æ–¥–Ω–æ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

**–í–∞—à —Å–ª—É—á–∞–π**: max confidence = 40% –æ–∑–Ω–∞—á–∞–µ—Ç –º–æ–¥–µ–ª—å "–ø—É—Ç–∞–µ—Ç—Å—è" –º–µ–∂–¥—É –∫–ª–∞—Å—Å–∞–º–∏.

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

#### 1.1. –ò—Å–∫–ª—é—á–∏—Ç—å cumsum-–∑–∞–≤–∏—Å–∏–º—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –∏–∑ –æ–±—É—á–µ–Ω–∏—è

–í `train_v3_dynamic.py` —É–∂–µ –µ—Å—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ:
```python
from src.utils.constants import CUMSUM_PATTERNS, ABSOLUTE_PRICE_FEATURES

features = [c for c in train_df.columns if c not in all_exclude 
            and not any(p in c.lower() for p in CUMSUM_PATTERNS)]
```

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ**: —á—Ç–æ `CUMSUM_PATTERNS` –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã:
- `'consecutive_up'`, `'consecutive_down'` - –¥–æ–±–∞–≤–∏—Ç—å –µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç!

#### 1.2. –ü–µ—Ä–µ–æ–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```bash
cd /Users/savelii/tradeAI && python scripts/train_v3_dynamic.py \
    --days 60 \
    --test_days 14 \
    --pairs 20 \
    --initial_balance 20 \
    --output ./models/v8_improved \
    --reverse \
    --walk-forward
```

**–í–∞–∂–Ω–æ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `--reverse` —á—Ç–æ–±—ã –æ–±—É—á–µ–Ω–∏–µ –±—ã–ª–æ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 60 –¥–Ω—è—Ö, –∞ —Ç–µ—Å—Ç –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö 30.

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –£–ª—É—á—à–µ–Ω–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

#### 2.1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏

–í–º–µ—Å—Ç–æ –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π EMA, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
- `ema_distance = (close - ema) / ema * 100` ‚Äî —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç —Ü–µ–Ω—ã –¥–æ EMA –≤ %
- `ema_slope = (ema - ema.shift(1)) / ema.shift(1) * 100` ‚Äî –Ω–∞–∫–ª–æ–Ω EMA –≤ %

–≠—Ç–æ —É–∂–µ —á–∞—Å—Ç–∏—á–Ω–æ —Å–¥–µ–ª–∞–Ω–æ –≤ `train_mtf.py` —Å—Ç—Ä–æ–∫–∏ 218-220:
```python
# ‚úÖ FIX: Store as % distance from price instead of absolute price
features['m1_ema_3'] = (ema_3 - df['close']) / df['close'] * 100
features['m1_ema_8'] = (ema_8 - df['close']) / df['close'] * 100
```

#### 2.2. –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–∏–∑–Ω–∞–∫–∏ –∫ ATR

–í–º–µ—Å—Ç–æ –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏:
```python
# –ë—ã–ª–æ:
features['m5_atr_14'] = atr_14  # $500 –¥–ª—è BTC

# –ù–∞–¥–æ:
features['m5_atr_14_pct'] = atr_14 / close * 100  # 2.5%
```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

#### 3.1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É

```bash
python scripts/diagnose_live_vs_backtest.py --all-pairs
```

–≠—Ç–æ –ø–æ–∫–∞–∂–µ—Ç:
- –ö–∞–∫–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –∏–º–µ—é—Ç drift >30%
- –ü–æ—á–µ–º—É live –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–∏–≥–Ω–∞–ª—ã

#### 3.2. –°—Ä–∞–≤–Ω–∏—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

```bash
python scripts/compare_feature_distributions.py
```

---

## –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π

1. **–°–µ–π—á–∞—Å**: –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
2. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å**: –î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –≤ `CUMSUM_PATTERNS`
3. **–ü–µ—Ä–µ–æ–±—É—á–∏—Ç—å**: –ú–æ–¥–µ–ª—å –Ω–∞ —Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏
4. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å**: Walk-forward validation –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å >50% Win Rate
5. **Paper Trading**: –ó–∞–ø—É—Å—Ç–∏—Ç—å live_trading –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
6. **Live**: –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ paper trading

---

## üîß –ë—ã—Å—Ç—Ä—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–µ—Å–ª–∏ —Å–∏–≥–Ω–∞–ª–æ–≤ –Ω–µ—Ç —Å–æ–≤—Å–µ–º)

### –í–∞—Ä–∏–∞–Ω—Ç 1: –°–Ω–∏–∑–∏—Ç—å –ø–æ—Ä–æ–≥–∏ (–ø–æ–ª—É—á–∏—à—å —Å–∏–≥–Ω–∞–ª—ã, –Ω–æ –±–æ–ª—å—à–µ –ª–æ–∂–Ω—ã—Ö)

–í —Ñ–∞–π–ª–µ `scripts/live_trading_v10_csv.py` –∏–∑–º–µ–Ω–∏—Ç–µ:

```python
# –ë—ã–ª–æ:
MIN_CONF = 0.50
MIN_TIMING = 0.8
MIN_STRENGTH = 1.4

# –°—Ç–∞–ª–æ (–±–æ–ª–µ–µ –º—è–≥–∫–∏–µ –ø–æ—Ä–æ–≥–∏):
MIN_CONF = 0.40
MIN_TIMING = 0.5
MIN_STRENGTH = 1.0
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ø—Ä–æ–±–ª–µ–º—ã

```bash
# –£–≤–∏–¥–µ—Ç—å –∫–∞–∫–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ "–ø–ª—ã–≤—É—Ç"
python scripts/diagnose_live_vs_backtest.py --pair BTC_USDT_USDT

# –°—Ä–∞–≤–Ω–∏—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
python scripts/compare_feature_distributions.py
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –û–±—É—á–∏—Ç—å –Ω–∞ –±–æ–ª—å—à–µ–º –æ–±—ä—ë–º–µ –¥–∞–Ω–Ω—ã—Ö

```bash
# 90 –¥–Ω–µ–π –≤–º–µ—Å—Ç–æ 60, –±–æ–ª—å—à–µ –ø–∞—Ä
python scripts/train_v3_dynamic.py --days 90 --test_days 30 --pairs 20 \
    --initial_balance 20 --output ./models/v8_improved --reverse --walk-forward
```

---

## –°—Å—ã–ª–∫–∏ –∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∏

### –°—Ç–∞—Ç—å–∏ –ø–æ —Ç–µ–º–µ (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º):
- https://habr.com/ru/articles/561638/ - –ü–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ –≤ ML –¥–ª—è —Ç—Ä–µ–π–¥–∏–Ω–≥–∞
- https://habr.com/ru/companies/ods/articles/560312/ - Feature Engineering –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã:
- [Feature Distribution Shift in ML](https://www.seas.upenn.edu/~obastani/cis7000/spring2024/docs/lecture3.pdf)
- [Backtesting vs Live Trading - MultiCharts](https://www.multicharts.com/trading-software/index.php?title=Backtesting_vs_Live_Trading)
- [Debugging Backtest vs Live Discrepancies](https://deepwiki.com/nkaz001/hftbacktest/7.4-debugging-backtest-vs-live-discrepancies)

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ–±–ª–µ–º–∞ "–Ω–µ—Ç —Å–∏–≥–Ω–∞–ª–æ–≤ –≤ live" ‚Äî —ç—Ç–æ **–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ ML –≤ —Ç—Ä–µ–π–¥–∏–Ω–≥–µ**, –≤—ã–∑–≤–∞–Ω–Ω–∞—è –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ñ–∞–∫—Ç–æ—Ä–∞–º–∏:

### –ü–æ—á–µ–º—É –º–æ–¥–µ–ª—å –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ live (–ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏):

1. **–ú–æ–¥–µ–ª—å "–≤–∏–¥–∏—Ç –±—É–¥—É—â–µ–µ" –ø—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏** ‚Äî –í `create_targets_v1()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `shift(-LOOKAHEAD)`, —á—Ç–æ –¥–∞—ë—Ç –º–æ–¥–µ–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–º, —á—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç —á–µ—Ä–µ–∑ 12 —Å–≤–µ—á–µ–π. –í live —ç—Ç–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–µ—Ç.

2. **Feature Distribution Shift** ‚Äî –ó–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –≤ live –æ—Ç–ª–∏—á–∞—é—Ç—Å—è –æ—Ç –æ–±—É—á–µ–Ω–∏—è (–∞–±—Å–æ–ª—é—Ç–Ω—ã–µ —Ü–µ–Ω—ã, cumsum, MACD).

3. **–†—ã–Ω–æ–∫ –º–µ–Ω—è–µ—Ç—Å—è** ‚Äî –ú–æ–¥–µ–ª—å –æ–±—É—á–µ–Ω–∞ –Ω–∞ –ø—Ä–æ—à–ª—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –∞ —Ä—ã–Ω–æ–∫ —Å–µ–π—á–∞—Å –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –¥—Ä—É–≥–æ–º —Ä–µ–∂–∏–º–µ.

4. **Win Rate 80% = –ü–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ** ‚Äî –¢–∞–∫–æ–π –≤—ã—Å–æ–∫–∏–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –±—ç–∫—Ç–µ—Å—Ç–µ –æ–±—ã—á–Ω–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –º–æ–¥–µ–ª—å "–∑–∞–ø–æ–º–Ω–∏–ª–∞" –¥–∞–Ω–Ω—ã–µ, –∞ –Ω–µ –Ω–∞—É—á–∏–ª–∞—Å—å –æ–±–æ–±—â–∞—Ç—å.

### –ß—Ç–æ –¥–µ–ª–∞—Ç—å:

1. **–°–Ω–∏–∑–∏—Ç—å –æ–∂–∏–¥–∞–Ω–∏—è** ‚Äî –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π Win Rate –¥–ª—è ML –≤ —Ç—Ä–µ–π–¥–∏–Ω–≥–µ: 55-65%
2. **–°–Ω–∏–∑–∏—Ç—å –ø–æ—Ä–æ–≥–∏** ‚Äî `MIN_CONF=0.40`, `MIN_TIMING=0.5` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
3. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É** ‚Äî `python scripts/diagnose_live_vs_backtest.py --all-pairs`
4. **Paper Trading** ‚Äî –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –¥–µ–Ω–µ–≥

**–ì–ª–∞–≤–Ω–æ–µ**: –û—Ç–ª–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ –±—ç–∫—Ç–µ—Å—Ç–µ ‚â† –æ—Ç–ª–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ live. –≠—Ç–æ –Ω–æ—Ä–º–∞ –¥–ª—è ML –≤ —Ç—Ä–µ–π–¥–∏–Ω–≥–µ.
